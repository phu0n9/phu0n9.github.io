<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title> Solar System Enhance</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        .webgl {
            position: fixed;
            top: 0;
            left: 0;
            outline: none;
        }

        .section {
            height: 100vh;
            position: relative;
            display: flex;
            align-items: center;
            font-family: 'Arial', sans-serif;
            color: #22b4d8;
            text-transform: uppercase;
            font-size: 7vmin;
            padding-left: 10%;
            padding-right: 10%;
        }

        /* .section:nth-child(odd) {
            justify-content: flex-end;
        } */

        .sound {
            width: 30px;
            height: 25px;
            top: 30px;
            left: 30px;
            background-color: transparent;
            position: relative;
            background-position: center;
            background-image: url(./textures/speaker_off.png);
            background-position: left;
            background-size: contain;
            background-repeat: no-repeat;
            cursor: pointer;
            opacity: 0.6;
        }

        p {
            font-size: 1.5vw;
            text-transform: none;
            color: #ffffff;
            text-align: justify;
            text-shadow: 2px 2px 3px #000000;
        }
    </style>
</head>

<body>
    <canvas class="webgl"></canvas>
    <section class="section">
    </section>
    <section class="section">
        <div class="item">
            <h1>The Solar System</h1>
            <p>
                Our solar system consists of our star, the Sun, and everything bound to it by gravity – the planets
                Mercury, Venus, Earth, Mars, Jupiter, Saturn, Uranus, and Neptune; dwarf planets such as Pluto; dozens
                of moons; and millions of asteroids, comets, and meteoroids.
            </p>
        </div>
    </section>

    <section class="section">
        <div class="item">
            <h1>The Sun</h1>
            <p>
                Sun is a yellow dwarf star, a hot ball of glowing gases.
                The Sun is the largest object in our solar system, comprising 99.8% of the system’s mass, with a
                diameter of 1,392,00 km
            </p>
        </div>
    </section>

    <section class="section">
        <!-- Don't mind the text, im just pasting some description -->
        <div class="item">
            <h1>Mercury - God of commerce and skill</h1>
            <p>
                The smallest planet in our solar system and nearest to the Sun, Mercury is only slightly larger than
                Earth's Moon.
                Mercury is the fastest planet in our solar system, traveling through space at nearly 29 mph.
            </p>
        </div>
    </section>

    <section class="section">
        <div class="item">
            <h1>Venus - Goddess of Beauty </h1>
            <p>
                Venus is the second planet from the Sun and is Earth's closest planetary neighbor.
                Venus was the first planet explored by a spacecraft- NASA’s Mariner 2 Successfully on 14 December 1962.
                Since then numerous spacecraft from the U.S. and other space agencies have explored Venus.
            </p>
        </div>
    </section>

    <section class="section">
        <div class="item">
            <h1>The Earth - Inhabited by living</h1>
            <p>
                Earth is the fifth largest planet. The planet is unique as the only planet in the solar system with
                liquid water on the surface.
                Earth has one moon. The atmosphere of Earth protects us from incoming meteoroids, most of which break up
                in our atmosphere before they can strike the surface.
            </p>
        </div>
    </section>

    <section class="section">
        <div class="item">
            <h1>The Sun</h1>
            <p>
                Sun is a yellow dwarf star, a hot ball of glowing gases.
                The Sun is the largest object in our solar system, comprising 99.8% of the system’s mass, with a
                diameter of 1,392,00 km
            </p>
        </div>
    </section>

    <section class="section">
        <div class="item">
            <h1>Mars - God of war</h1>
            <p>
                Mars is a Dusty, cold, desert world with a very thin atmosphere.
                There is strong evidence Mars was—billions of years ago—wetter and warmer, with a thicker atmosphere.
            </p>
        </div>
    </section>

    <section class="section">
        <div class="item">
            <h1>Jupiter - Ruler of Gods</h1>
            <p>
                The fifth planet from our Sun and is, by far, the largest planet in the solar system and has the
                shortest day in the solar system.
                Jupiter's stripes and swirls are cold, windy clouds of ammonia and water, floating in an atmosphere of
                hydrogen and helium.
            </p>
        </div>
    </section>

    <section class="section">
        <div class="item">
            <h1>Saturn - God of Agriculture</h1>
            <p>
                Saturn is a massive ball made mostly of hydrogen and helium.
                Saturn is the only planet in our solar system with an average density that is less than water.
                It is a gas giant; Saturn doesn't have a true surface.
                Saturn's rings are thought to be pieces of comets, asteroids, or shattered moons that broke up before
                they reached the planet, torn apart by Saturn's powerful gravity.
                The main rings are A, B, and C. Rings D, E, F, and G are fainter and more recently discovered.
            </p>
        </div>
    </section>

    <section class="section">
        <div class="item">
            <h1>Uranus - God of Heavens</h1>
            <p>
                Uranus is the seventh planet from the Sun, with the third largest diameter in our solar system.
                It was the first planet found with the aid of a telescope, in 1781 by astronomer William Herschel.
            </p>
        </div>
    </section>

    <section class="section">
        <div class="item">
            <h1>Neptune - God of the Sea</h1>
            <p>
                The eighth planet from Sun and the only planet in our solar system not visible to the naked eye and the
                first predicted by mathematics before its discovery.
                In 2011 Neptune completed its first 165-year orbit since its discovery in 1846. (Source NASA)- NASA’s
                Voyager 2 is the only spacecraft to have visited Neptune up close
            </p>
        </div>
    </section>

    <section class="section">
        <div id="sound"></div>
    </section>
    <audio preload="auto" type="audio/ogg" loop src="./media/colossal_trailer_music_gaze.ogg">
        Your browser does not support the
        <code>audio</code> element.
    </audio>
    <script defer src="https://ga.jspm.io/npm:es-module-shims@1.6.2/dist/es-module-shims.js"></script>
    <script type="importmap">
      {
        "imports": {
            "three": "https://unpkg.com/three@0.147.0/build/three.module.js",
            "lil-gui": "https://unpkg.com/lil-gui@0.16.1/dist/lil-gui.esm.js",
            "orbitControl": "https://unpkg.com/three@0.141.0/examples/jsm/controls/OrbitControls.js",
            "fontLoader": "https://unpkg.com/three@0.147.0/examples/jsm/loaders/FontLoader.js",
            "textGeometry": "https://unpkg.com/three@0.147.0/examples/jsm/geometries/TextGeometry.js",
            "gsap": "https://cdn.skypack.dev/gsap"
        }
      }
    </script>
    <script type="module">
        import * as THREE from "three";
        import { OrbitControls } from "orbitControl";
        import * as dat from "lil-gui";
        import { FontLoader } from 'fontLoader';
        import { TextGeometry } from 'textGeometry';
        import { gsap } from "gsap";

        let camera, controls, scene, renderer, canvas;
        let sun, planetRing, planetRing2, planetRing3, planetRing4, planetObject, moon, textMesh, sectionMeshes;

        const planets = [
            { name: 'mercury', sizeRatio: 100 / 277, position: 15, rotation: 0.0002, inclination: 7.0, moonNum: 0 },
            { name: 'venus', sizeRatio: 100 / 133, position: 20, rotation: 0.00075, inclination: 3.4, moonNum: 0 },
            { name: 'earth', sizeRatio: 100 / 103, position: 25, rotation: 0.00065, inclination: 0, moonNum: 1 },
            { name: 'mars', sizeRatio: 100 / 208, position: 30, rotation: 0.00025, inclination: 1.8, moonNum: 2 },
            { name: 'jupiter', sizeRatio: 30 / 9.68, position: 40, rotation: 0.00055, inclination: 1.3, moonNum: 92 },
            { name: 'saturn', sizeRatio: 30 / 11.4, position: 50, rotation: 0.0004, inclination: 1.3, moonNum: 83 },
            { name: 'uranus', sizeRatio: 30 / 26.8, position: 60, rotation: 0.0006, inclination: 0.8, moonNum: 27 },
            { name: 'neptune', sizeRatio: 30 / 27.7, position: 70, rotation: 0.0003, inclination: 1.8, moonNum: 14 },
        ];

        const earthMoon = { name: 'luna', sizeRatio: 55 / 105, position: 3, rotation: 0.005, inclination: 5.1 }
        const orbitRadius = [15, 20, 25, 30, 40, 50, 60, 70];
        const orbitsObject3D = [];
        const planetsObject3D = [];

        // Config
        const gui = new dat.GUI()
        canvas = document.querySelector('canvas.webgl')
        scene = new THREE.Scene()
        const textureLoader = new THREE.TextureLoader()

        const particlesTexture = textureLoader.load('./textures/particles/5.png')
        const particlesGeometry = new THREE.SphereGeometry(5, 25, 25)
        const count = 8888
        const positions = new Float32Array(count * 3)
        const colors = new Float32Array(count * 4)

        // Cursor
        const cursor = {}
        cursor.x = 0
        cursor.y = 0

        // Size
        const sizes = {
            width: window.innerWidth,
            height: window.innerHeight
        }

        window.addEventListener('resize', onWindowResize);
        // Scroll
        let scrollY = window.scrollY
        let currentSection = 0
        window.addEventListener('scroll', userScroll);
        // Camera
        camera = new THREE.PerspectiveCamera(75, sizes.width / sizes.height, 5, 20000)
        camera.position.set(100, 50, 50)
        scene.add(camera)

        const params = {
            topCameraView: () => {
                topCameraView()
            },
            enableSound: () => {
                initSound()
            },
            flyByCamera: () => {
                flyByCamera()
            }
        }

        const topCameraView = () => {
            camera.position.set(0, 100, 0)
            camera.lookAt(sun.position)
            textMesh.position.set(0, 0, -50);
            textMesh.lookAt(camera.position)

        }

        const flyByCamera = () => {
            camera.position.set(100, 50, 50)
            textMesh.position.set(50, 55, 25);
            textMesh.lookAt(camera.position);
            camera.position.x += .01;
            camera.position.y += -.01;
            camera.position.z += -.05;

            if (camera.position.z < -100) {
                camera.position.set(100, 50, 50);
            }
        }

        // Controls
        controls = new OrbitControls(camera, canvas)
        controls.enableDamping = true

        // Renderer
        renderer = new THREE.WebGLRenderer({ canvas: canvas })
        renderer.setSize(sizes.width, sizes.height)
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))
        //renderer.physicallyCorrectLights = true

        function init() {
            // Background
            loadWorldMap()

            loadTitle()

            // Create sun
            generateSun()

            // Light
            generateLight()

            // Ring system: Jupyter, Saturn, Uranus, Neptune
            generatePlanetRing()

            // Create other planets
            generatePlanets()

            generateScrollPlanet()

            // Debug 
            debugConfiguration()
        }
        init()

        function loadWorldMap() {
            scene.background = new THREE.Color(0x000000);
            const spaceLoader = new THREE.CubeTextureLoader();
            const spaceTexture = spaceLoader.load([
                "textures/background/space-xpos.jpg",
                "textures/background/space-xneg.jpg",
                "textures/background/space-ypos.jpg",
                "textures/background/space-yneg.jpg",
                "textures/background/space-zpos.jpg",
                "textures/background/space-zneg.jpg",
            ]);
            scene.background = spaceTexture;
        }

        function loadTitle() {
            // Text
            const loader = new FontLoader();
            loader.load('fonts/helvetiker_regular.typeface.json', function (font) {
                const textGeometry = new TextGeometry('3D Solar System', {
                    font: font,
                    size: 4,
                    height: 1,
                    curveSegments: 5,
                    bevelEnabled: true,
                    bevelThickness: 0.3,
                    bevelSize: 0.004,
                    bevelOffset: -0.1,
                    bevelSegments: 5,
                });
                textGeometry.center();
                const matcapTexture = textureLoader.load('./textures/matcaps/5.png')
                const material = new THREE.MeshMatcapMaterial({ matcap: matcapTexture })
                textMesh = new THREE.Mesh(
                    textGeometry,
                    material
                )
                scene.add(textMesh)
                textMesh.position.set(50, 55, 25);
                textMesh.lookAt(camera.position);
            })
        }

        function generateLight() {
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.2)
            scene.add(ambientLight)
        }

        function generateSun() {
            sun = new THREE.Mesh(
                new THREE.SphereGeometry(10, 32, 32),
                new THREE.MeshStandardMaterial({ map: textureLoader.load('./textures/sun_detailed.jpg') }));
            const ambientLight = new THREE.AmbientLight(0x404040);
            const hemisphereLight = new THREE.HemisphereLight(0xffffbb, 0x080820, 1);
            scene.add(sun, ambientLight, hemisphereLight)
        }

        function generatePlanets() {
            const orbitMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
            planets.forEach((planet, index) => {
                const orbitGroup = new THREE.Group()
                const orbit = new THREE.Mesh(
                    new THREE.TorusGeometry(orbitRadius[index], 0.03, 16, 100),
                    orbitMaterial
                )

                const texture = textureLoader.load(`./textures/${planet.name}.jpg`)
                planetObject = new THREE.Mesh(
                    new THREE.SphereGeometry(planet.sizeRatio, 32, 32),
                    new THREE.MeshStandardMaterial({ map: texture }))

                planetObject.position.x = planet.position

                if (planet.name === 'saturn') {
                    planetRing.position.x = planet.position
                    orbitGroup.add(planetRing)
                }

                if (planet.name === 'jupiter') {
                    planetRing2.position.x = planet.position
                    orbitGroup.add(planetRing2)
                }

                if (planet.name === 'uranus') {
                    planetRing3.position.x = planet.position
                    orbitGroup.add(planetRing3)
                }

                if (planet.name === 'neptune') {
                    planetRing4.position.x = planet.position
                    orbitGroup.add(planetRing4)
                }

                if (planet.name === 'earth') {
                    generateMoon()
                    moon.position.x = planet.position + 3;
                    orbitGroup.add(moon)
                }

                orbitGroup.add(orbit, planetObject)
                orbit.rotateZ(Math.PI / 2)
                orbit.rotateY(Math.PI / 2)
                orbitsObject3D.push(orbitGroup)
                planetsObject3D.push(planetObject)

                scene.add(orbitGroup)
            })
        }

        function generateScrollPlanet() {
            const sunTexture = textureLoader.load('./textures/sun_alpha.jpg')
            const sunObject = new THREE.Mesh(
                new THREE.SphereGeometry(32, 32, 32),
                new THREE.MeshStandardMaterial({
                    map: sunTexture
            }))
            //scene.add(sunObject)
            sunObject.position.x = 0
            sunObject.position.y = -20
            //sunObject.castShadow = true
            sunObject.receiveShadow = true

            sectionMeshes = [sunObject]
        }

        function generateMoon() {
            const moonGeometry = new THREE.SphereGeometry(earthMoon.sizeRatio, 50, 50);
            const moonMaterial = new THREE.MeshPhongMaterial({
                map: textureLoader.load("./textures/moon_texture.jpg")
            });
            moon = new THREE.Mesh(moonGeometry, moonMaterial);
        }
        function generatePlanetRing() {
            const orbitMaterial = new THREE.MeshLambertMaterial({
                map: textureLoader.load('./textures/2k_saturn_ring_alpha.png'),
                transparent: true,
                side: THREE.DoubleSide,
            })
            const ringGeometry = new THREE.RingGeometry(3, 5, 64)
            const pos = ringGeometry.attributes.position
            const v3 = new THREE.Vector3()
            for (let i = 0; i < pos.count; i++) {
                v3.fromBufferAttribute(pos, i)
                ringGeometry.attributes.uv.setXY(i, v3.length() < 4 ? 0 : 1, 1)
            }

            planetRing = new THREE.Mesh(ringGeometry, orbitMaterial);
            planetRing.rotateX(Math.PI / 2.5)
            planetRing2 = new THREE.Mesh(new THREE.TorusGeometry(3, 0.02, 16, 100), orbitMaterial);
            planetRing2.rotateX(Math.PI / 3)
            planetRing3 = new THREE.Mesh(new THREE.TorusGeometry(3, 0.02, 16, 100), orbitMaterial);
            planetRing3.rotateX(Math.PI / 3.5)
            planetRing4 = new THREE.Mesh(new THREE.TorusGeometry(3, 0.02, 16, 100), orbitMaterial);
            planetRing4.rotateX(Math.PI / 4.5)
        }

        function userScroll() {
            scrollY = window.scrollY
            const newSection = Math.round(scrollY / sizes.height)
            if (newSection != currentSection) {
                currentSection = newSection
                gsap.to(
                    sectionMeshes[currentSection].rotation,
                    {
                        duration: 1.5,
                        ease: 'power2.inOut',
                        x: '+=1',
                        y: '+=1',
                        z: '+=1'
                    }
                )
            }
        }

        function initSound() {
            let audioElement = document.querySelector('audio'),
                speakerButton = document.getElementById('sound');

            speakerButton.addEventListener('click', () => {
                if (!this.soundOn) {
                    audioElement.play();
                    this.soundOn = true;
                    speakerButton.style.opacity = 1;
                    speakerButton.style.backgroundImage = 'url("./textures/speaker_on.png")'
                } else {
                    audioElement.pause();
                    this.soundOn = false;
                    speakerButton.style.opacity = 0.6;
                    speakerButton.style.backgroundImage = 'url("./textures/speaker_off.png")'
                }
            })
        }

        function debugConfiguration() {
            gui.add(camera.position, 'z', -250, 250, 1)
            gui.add(camera.position, 'y', -250, 250, 1)
            gui.add(camera.position, 'x', -250, 250, 1)
            gui.add(params, 'topCameraView').name('Camera Top View')
            gui.add(params, 'flyByCamera').name('Fly By Camera')
        }

        // Animate
        const clock = new THREE.Clock()
        let previousTime = 0;
        const animate = () => {
            // Asteroids
            const elapsedTime = clock.getElapsedTime()
            const deltaTime = elapsedTime - previousTime;
            previousTime = elapsedTime;
            for (let i = 0; i < count; i++) {
                let i3 = i * 3
                const x = particlesGeometry.attributes.position.array[i3]
                particlesGeometry.attributes.position.array[i3 + 3] = Math.sin(elapsedTime + 4 * x)
            }
            particlesGeometry.attributes.position.needsUpdate = true

            // Planet rotations
            sun.rotation.y += Math.abs(Math.sin(elapsedTime * 3)) * 0.001
            sun.rotation.z += Math.sin(elapsedTime) * 1.5 * 0.001
            moon.rotation.y += Math.abs(Math.sin(elapsedTime * 30)) * 0.001
            moon.rotation.z += Math.sin(elapsedTime) * 15 * 0.001

            orbitsObject3D.forEach((group, index) => {
                group.rotation.y += planets[index].rotation
                group.rotation.x += planets[index].rotation
            })

            planetsObject3D.forEach((planet, index) => {
                planet.rotation.y += planets[index].rotation * 2
                planet.rotation.x += planets[index].rotation * 2
            })

            // camera.position.y = - scrollY / sizes.height * 1
            // const parallaxX = cursor.x * 0.5
            // const parallaxY = -cursor.y * 0.5

            // camera.position.x += (parallaxX - camera.position.x) * 2 * deltaTime;
            // camera.position.y += (parallaxY - camera.position.y) * 2 * deltaTime;
            // Rotate the meshes
            for (const mesh of sectionMeshes) {
                mesh.rotation.x = deltaTime * 0.1
                mesh.rotation.y = deltaTime * 0.12
            }

            controls.update()

            render();

            window.requestAnimationFrame(animate)
        }

        animate()

        function onWindowResize() {
            sizes.width = window.innerWidth
            sizes.height = window.innerHeight
            camera.aspect = sizes.width / sizes.height
            camera.updateProjectionMatrix()
            renderer.setSize(sizes.width, sizes.height)
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))
        }

        function render() {
            renderer.render(scene, camera);
        }
    </script>
</body>

</html>